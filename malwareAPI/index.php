<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
<style>
        body {
            background-color: #333; /* Darker shade background color */
            color: #fff; /* Text color */
            font-family: Arial, sans-serif;
            text-align: center;
            padding: 20px;
        }

        .container {
            background-color: rgba(0, 0, 0, 0.7); /* Semi-transparent dark overlay */
            padding: 20px;
            border-radius: 10px;
            max-width: 400px;
            margin: 0 auto;
        }

        input[type="file"] {
            background-color: #444; /* Darker shade for file input */
            color: #fff;
            border: none;
            padding: 10px;
            border-radius: 5px;
        }

        input[type="submit"] {
            background-color: #007bff; /* Button background color (blue) */
            color: #fff;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
        }

        input[type="submit"]:hover {
            background-color: #0056b3; /* Darker shade on hover */
        }
    </style>
</head>
<body>
    <div class="container">
        <h2>Check for Malwares</h2>
        <form action="index.php" method="post" enctype="multipart/form-data">
            <input type="file" name="fileToUpload" id="fileToUpload">
            <br><br>
            <input type="submit" value="Submit" name="submit">
        </form>

        <?php
        session_start();
        if (isset($_POST["submit"])) {
            // Handle file upload and API request
            $apiKey = 'qph6wrg193b9e5c0x06lr3xa7b9d9adfwvps4dbp29f5d076ovef3jd2a14159ee';
            $baseurl = 'https://hybrid-analysis.com/api/v2/';

            // Check if a file was uploaded
            if (isset($_FILES["fileToUpload"]) && $_FILES["fileToUpload"]["error"] == UPLOAD_ERR_OK) {
                $fileTempPath = $_FILES["fileToUpload"]["tmp_name"];
                $hash = hash_file('sha256', $fileTempPath);

                // Make API request
                $url = $baseurl . 'overview/' . $hash;
                $headers = [
                    'Accept: application/json',
                    'User-Agent: Falcon Sandbox',
                    'Api-Key: ' . $apiKey,
                ];

                $ch = curl_init();
                curl_setopt($ch, CURLOPT_URL, $url);
                curl_setopt($ch, CURLOPT_HTTPGET, true);
                curl_setopt($ch, CURLOPT_HTTPHEADER, $headers);
                curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
                $response = curl_exec($ch);
                curl_close($ch);

                // Display results
                if ($response !== false) {
                    $response = json_decode($response, true);
                    if (!empty($response)) {
                        // Check if the expected keys exist in the response
                        if (isset($response['scanners'])) {
                            // Extract relevant information
                            $scanners = $response['scanners'];
                            echo "<h3>Scanners Status:</h3>";
                            echo "<ul>";
                            foreach ($scanners as $scanner) {
                                // Check if the scanner is one of the required ones
                                if ($scanner['name'] == 'CrowdStrike Falcon Static Analysis (ML)' ||
                                    $scanner['name'] == 'Metadefender' ||
                                    $scanner['name'] == 'VirusTotal') {
                                    echo "<li>{$scanner['name']}: {$scanner['status']}</li>";
                                }
                            }
                            echo "</ul>";
                        } else {
                            echo "<p>File is Safe!</p>";
                        }

                        if (isset($response['verdict'])) {
                            // Display final verdict
                            echo "<h3>Final Verdict:</h3>";
                            echo "<p>{$response['verdict']}</p>";
                        } else {
                            echo "";
                        }
                    } else {
                        echo "No results found.";
                    }
                } else {
                    echo "Error fetching results.";
                }
            } else {
                echo "Please choose a file";
            }
        }
        ?>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js" integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.min.js" integrity="sha384-BBtl+eGJRgqQAUMxJ7pMwbEyER4l1g+O15P+16Ep7Q9Q+zqX6gSbd85u4mG4QzX+" crossorigin="anonymous"></script>
</body>
</html>